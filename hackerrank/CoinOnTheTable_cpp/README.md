This problem is similar to the ChessMetric on TopCoder.

Complexity: O(NMK)
See Editorial
